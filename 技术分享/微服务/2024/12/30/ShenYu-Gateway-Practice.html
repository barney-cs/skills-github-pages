<!DOCTYPE html>
<html lang="en-US" data-theme="default">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="/assets/css/themes.css?v=">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  </head>
  <body>
    <!-- 主题切换器 -->
    <div class="theme-switcher animate__animated animate__fadeIn">
      <div class="theme-options">
        <div class="theme-option active" data-theme="default" title="默认主题"></div>
        <div class="theme-option" data-theme="dark" title="暗黑主题"></div>
        <div class="theme-option" data-theme="ocean" title="海洋主题"></div>
        <div class="theme-option" data-theme="forest" title="森林主题"></div>
        <div class="theme-option" data-theme="sunset" title="日落主题"></div>
      </div>
    </div>

    <div class="container-lg px-3 my-5 markdown-body">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ShenYu 网关实践指南：架构设计与功能扩展</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-12-30T00:00:00+00:00" itemprop="datePublished">
        Dec 30, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="shenyu-网关实践指南架构设计与功能扩展">ShenYu 网关实践指南：架构设计与功能扩展</h1>

<h2 id="简介">简介</h2>

<p>Apache ShenYu 是一个异步的、高性能的、跨语言的、响应式的 API 网关。本文将详细介绍 ShenYu 的架构设计、核心功能以及实际应用中的最佳实践。</p>

<h2 id="核心特性">核心特性</h2>

<h3 id="1-插件化架构">1. 插件化架构</h3>

<p>ShenYu 采用插件化设计，主要包括：</p>

<ul>
  <li>流量控制插件</li>
  <li>安全认证插件</li>
  <li>监控统计插件</li>
  <li>协议转换插件</li>
</ul>

<h3 id="2-动态配置">2. 动态配置</h3>

<p>通过 Admin 控制台实现配置的动态变更：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># application.yml</span>
<span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">sync</span><span class="pi">:</span>
    <span class="na">websocket</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">urls</span><span class="pi">:</span> <span class="s">ws://localhost:9095/websocket</span>
</code></pre></div></div>

<h2 id="实战应用">实战应用</h2>

<h3 id="1-环境搭建">1. 环境搭建</h3>

<h4 id="docker-部署">Docker 部署</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">shenyu-admin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">apache/shenyu-admin:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9095:9095"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">SPRING_PROFILES_ACTIVE=mysql</span>
      
  <span class="na">shenyu-bootstrap</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">apache/shenyu-bootstrap:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9195:9195"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">shenyu-admin</span>
</code></pre></div></div>

<h4 id="数据库初始化">数据库初始化</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">shenyu</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8mb4</span> <span class="k">COLLATE</span> <span class="n">utf8mb4_unicode_ci</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="2-插件配置">2. 插件配置</h3>

<h4 id="限流插件">限流插件</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RateLimiterConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RateLimiterPlugin</span> <span class="nf">rateLimiterPlugin</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RateLimiterPlugin</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisRateLimiter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>配置规则：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/**"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rateLimit"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"capacity"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
        </span><span class="nl">"rate"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="jwt-认证插件">JWT 认证插件</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">JwtPlugin</span> <span class="nf">jwtPlugin</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JwtPlugin</span><span class="o">(</span><span class="k">new</span> <span class="nc">JwtService</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>配置示例：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">jwt</span><span class="pi">:</span>
    <span class="na">secret</span><span class="pi">:</span> <span class="s">your-secret-key</span>
    <span class="na">expire</span><span class="pi">:</span> <span class="m">3600</span>
</code></pre></div></div>

<h3 id="3-服务注册">3. 服务注册</h3>

<h4 id="spring-cloud-接入">Spring Cloud 接入</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@ShenyuSpringCloudClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>配置服务：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-type</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">server-lists</span><span class="pi">:</span> <span class="s">http://localhost:9095</span>
    <span class="na">props</span><span class="pi">:</span>
      <span class="na">contextPath</span><span class="pi">:</span> <span class="s">/api</span>
      <span class="na">appName</span><span class="pi">:</span> <span class="s">spring-cloud-service</span>
</code></pre></div></div>

<h4 id="dubbo-接入">Dubbo 接入</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DubboService</span>
<span class="nd">@ShenyuDubboClient</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="nd">@ShenyuDubboClient</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/findById"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="4-自定义插件开发">4. 自定义插件开发</h3>

<h4 id="插件实现">插件实现</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomPlugin</span> <span class="kd">extends</span> <span class="nc">AbstractShenyuPlugin</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">ShenyuPluginChain</span> <span class="n">chain</span><span class="o">,</span> <span class="nc">ServerWebExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 插件逻辑实现</span>
        <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">named</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"custom-plugin"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="插件配置">插件配置</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PluginConfiguration</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">PluginDataHandler</span> <span class="nf">customPluginDataHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomPluginDataHandler</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="性能优化">性能优化</h2>

<h3 id="1-线程池优化">1. 线程池优化</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">netty</span><span class="pi">:</span>
    <span class="na">tcp</span><span class="pi">:</span>
      <span class="na">selectCount</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">workerCount</span><span class="pi">:</span> <span class="m">4</span>
      <span class="na">connectTimeoutMillis</span><span class="pi">:</span> <span class="m">10000</span>
</code></pre></div></div>

<h3 id="2-内存优化">2. 内存优化</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># JVM参数优化</span>
<span class="nt">-Xms4g</span>
<span class="nt">-Xmx4g</span>
<span class="nt">-XX</span>:+UseG1GC
<span class="nt">-XX</span>:MaxGCPauseMillis<span class="o">=</span>100
</code></pre></div></div>

<h3 id="3-缓存优化">3. 缓存优化</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">cache</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">caffeine</span>
    <span class="na">caffeine</span><span class="pi">:</span>
      <span class="na">initialCapacity</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">maximumSize</span><span class="pi">:</span> <span class="m">100000</span>
      <span class="na">expireAfterWrite</span><span class="pi">:</span> <span class="s">60s</span>
</code></pre></div></div>

<h2 id="监控运维">监控运维</h2>

<h3 id="1-监控指标">1. 监控指标</h3>

<h4 id="metrics-配置">Metrics 配置</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">metrics</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">127.0.0.1</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">8090</span>
    <span class="na">jmxConfig</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div>

<h4 id="grafana-面板">Grafana 面板</h4>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"dashboard"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"panels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"QPS"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"graph"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Prometheus"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rate(shenyu_request_total[1m])"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-日志配置">2. 日志配置</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="na">root</span><span class="pi">:</span> <span class="s">INFO</span>
    <span class="na">org.apache.shenyu</span><span class="pi">:</span> <span class="s">DEBUG</span>
  <span class="na">file</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">./logs/shenyu-bootstrap.log</span>
</code></pre></div></div>

<h3 id="3-告警配置">3. 告警配置</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">alert</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">webhook</span>
    <span class="na">webhook</span><span class="pi">:</span>
      <span class="na">url</span><span class="pi">:</span> <span class="s">http://alert-server/webhook</span>
</code></pre></div></div>

<h2 id="最佳实践">最佳实践</h2>

<h3 id="1-高可用部署">1. 高可用部署</h3>

<h4 id="admin-集群">Admin 集群</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">shenyu</span><span class="pi">:</span>
  <span class="na">database</span><span class="pi">:</span>
    <span class="na">dialect</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">init_script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sql/schema.sql"</span>
  <span class="na">sync</span><span class="pi">:</span>
    <span class="na">zookeeper</span><span class="pi">:</span>
      <span class="na">url</span><span class="pi">:</span> <span class="s">localhost:2181</span>
      <span class="na">sessionTimeout</span><span class="pi">:</span> <span class="m">5000</span>
      <span class="na">connectionTimeout</span><span class="pi">:</span> <span class="m">2000</span>
</code></pre></div></div>

<h4 id="gateway-集群">Gateway 集群</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">nacos</span><span class="pi">:</span>
      <span class="na">discovery</span><span class="pi">:</span>
        <span class="na">server-addr</span><span class="pi">:</span> <span class="s">localhost:8848</span>
        <span class="na">namespace</span><span class="pi">:</span> <span class="s">shenyu</span>
</code></pre></div></div>

<h3 id="2-灰度发布">2. 灰度发布</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ShenyuSpringCloudClient</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/user"</span><span class="o">)</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/info"</span><span class="o">)</span>
    <span class="nd">@ShenyuSpringCloudClient</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/info"</span><span class="o">,</span> <span class="n">gray</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">getInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 灰度版本逻辑</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">getInfo</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3-服务降级">3. 服务降级</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FallbackConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ShenyuFallbackHandler</span> <span class="nf">fallbackHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">exchange</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SERVICE_UNAVAILABLE</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">writeWith</span><span class="o">(</span>
                <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">bufferFactory</span><span class="o">().</span><span class="na">wrap</span><span class="o">(</span><span class="s">"Service unavailable"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()))</span>
            <span class="o">);</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="总结">总结</h2>

<p>ShenYu 网关作为一个高性能的 API 网关，通过其插件化架构和丰富的功能特性，能够很好地满足微服务架构下的网关需求。本文介绍的实践经验和优化建议，都是基于实际生产环境的应用总结。</p>

<h2 id="参考资料">参考资料</h2>

<ul>
  <li><a href="https://shenyu.apache.org/docs/index/">Apache ShenYu 官方文档</a></li>
  <li><a href="https://github.com/apache/shenyu">ShenYu Github</a></li>
  <li><a href="https://shenyu.apache.org/blog/">ShenYu 实践案例</a></li>
</ul>

  </div>

  <div class="post-categories">
    
    <p class="post-meta">
      分类：
      
      <span class="post-category">技术分享</span>
      
      <span class="post-category">微服务</span>
      
    </p>
    
  </div>

  <div class="post-tags">
    
    <p class="post-meta">
      标签：
      
      <span class="post-tag">ShenYu</span>
      
      <span class="post-tag">API网关</span>
      
      <span class="post-tag">微服务架构</span>
      
    </p>
    
  </div>

  
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="/assets/js/gitalk-config.js"></script>
  <script>
    var gitalk = new Gitalk({
      clientID: GITALK_CLIENT_ID,
      clientSecret: GITALK_CLIENT_SECRET,
      repo: 'skills-github-pages',
      owner: 'barney-cs',
      admin: ["barney-cs"],
      id: location.pathname.substring(0, 50),
      language: 'zh-CN',
      distractionFreeMode: false
    });

    gitalk.render('gitalk-container');
  </script>

  <style>
  #gitalk-container {
      margin-top: 50px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  }

  .gt-container .gt-btn {
      background-color: #1e80ff !important;
      border-color: #1e80ff !important;
  }

  .gt-container .gt-btn:hover {
      background-color: #0366d6 !important;
      border-color: #0366d6 !important;
  }

  .gt-container .gt-link {
      color: #1e80ff !important;
  }

  .gt-container .gt-link:hover {
      color: #0366d6 !important;
  }

  .gt-container .gt-header-controls-tip {
      color: #666 !important;
  }
  </style>
  

  <a class="u-url" href="/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/%E5%BE%AE%E6%9C%8D%E5%8A%A1/2024/12/30/ShenYu-Gateway-Practice.html" hidden></a>
</article>

<style>
.post-category {
    background: #f0f0f0;
    padding: 4px 8px;
    border-radius: 4px;
    margin-right: 8px;
    font-size: 0.9em;
    color: #666;
}

.post-tag {
    background: #e8f0ff;
    padding: 4px 8px;
    border-radius: 4px;
    margin-right: 8px;
    font-size: 0.9em;
    color: #0366d6;
}

/* 代码高亮 */
.highlight {
  background: #f8f9fa;
  border-radius: 4px;
  margin: 1.5rem 0;
}

.highlight pre {
  padding: 1rem;
  margin: 0;
  overflow-x: auto;
}

/* 引用样式 */
blockquote {
  margin: 1.5rem 0;
  padding: 1rem 1.5rem;
  border-left: 4px solid #1e80ff;
  background: #f4f5f5;
  color: #666;
}

/* 表格样式 */
table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
}

th, td {
  padding: 0.75rem;
  border: 1px solid #eee;
}

th {
  background: #f8f9fa;
  font-weight: 600;
  color: #1d2129;
}

tr:nth-child(even) {
  background: #f8f9fa;
}

.gt-error-msg {
  text-align: center;
  padding: 1rem;
  color: #666;
  background: #f8f9fa;
  border-radius: 4px;
}
</style>

    </div>

    <script>
      // 主题切换功能
      document.addEventListener('DOMContentLoaded', function() {
        const themeOptions = document.querySelectorAll('.theme-option');
        const root = document.documentElement;
        
        // 从本地存储加载主题
        const savedTheme = localStorage.getItem('selected-theme');
        if (savedTheme) {
          root.setAttribute('data-theme', savedTheme);
          themeOptions.forEach(option => {
            option.classList.toggle('active', option.dataset.theme === savedTheme);
          });
        }

        // 主题切换事件监听
        themeOptions.forEach(option => {
          option.addEventListener('click', function() {
            const theme = this.dataset.theme;
            
            // 更新激活状态
            themeOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            
            // 应用主题
            root.setAttribute('data-theme', theme);
            
            // 保存到本地存储
            localStorage.setItem('selected-theme', theme);

            // 添加切换动画
            document.body.style.transition = 'background-color 0.3s ease';
            document.querySelectorAll('*').forEach(element => {
              element.style.transition = 'all 0.3s ease';
            });
          });
        });
      });
    </script>
  </body>
</html>
